%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                              %
%                              Required Packages                               %
%                                                                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Required for creating documents
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% Required math packages
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{mathrsfs}

\usepackage{multicol} % for multiple columns
\usepackage[usenames,dvipsnames,pdftex]{color} % Required for nicer colors
\usepackage{hyperref} % Required for hyperlinks
\usepackage{xparse} % Required for \NewDocumentCommand
\usepackage{graphicx} % Required for including images
\usepackage{enumitem} % Required for customizing lists
\usepackage{float} % Required for positioning figures and tables
\usepackage{array} % Required for customizing tables
\usepackage{systeme} % Required for \systeme
\usepackage{cancel} % Required for \cancel
\usepackage{derivative} % Required for \odv and \pdv
\usepackage{authoraftertitle} % Required for \MyTitle
\usepackage{geometry} % Required for customizing page layout
\usepackage{chemfig} % Required for drawing chemical structures
\usepackage{textgreek} % Required for greek letters in text mode
\usepackage{multirow} % Required for multirow in tables
\usepackage{minitoc} % Required for creating a mini table of contents
\usepackage[noabbrev]{cleveref} % Required for clever referencing
\usepackage{emptypage} % Required for removing page numbers on empty pages
\usepackage{nicematrix} % Required for better matrices
\usepackage{booktabs} % Required for better tables
\usepackage{cellspace} % Required for better spacing in tables
\usepackage{longtable} % Required for long tables
\usepackage{xfrac} % Required for extra fraction options
\usepackage{diagbox} % Required for creating diagonal boxes
\usepackage{polynom} % Required for polynomial long division
\usepackage{xr} % Required for cross-referencing
\usepackage{setspace} % For line spacing

\usepackage{tasks} % Required for creating tasks
\usepackage[font=bf]{caption} % Required for customizing captions
\usepackage{subcaption} % Required for creating subfigures
\usepackage{siunitx} % Required for SI units
\usepackage{titletoc} % Required for customizing table of contents
\usepackage[framemethod=TikZ]{mdframed} % Required for creating boxes
\usepackage{braket} % Required for creating braket notation

% Required for drawing figures
\usepackage{tikz}
\usepackage{pgffor}
\usepackage{tkz-euclide}
\usepackage{tikz-cd}
\usepackage{tikz-3dplot}
\usepackage{circuitikz}

% Required for creating plots
\usepackage{pgfplots}
\usepackage{pgfplotstable}

\usepackage{titling} % Required for customizing title page
\usepackage{ifthen} % Required for if-then-else statements
\usepackage{xifthen} % Required for if-then-else statements
\usepackage{fancyhdr} % Required for customizing headers and footers
\usepackage{import} % Required for importing pdf_tex files
\usepackage{titlesec} % Required for customizing sectioning commands
\usepackage{etex} % Required for more registers

% Required for creating boxes
\usepackage{varwidth}
\usepackage{thmtools}
\usepackage{etoolbox}
\usepackage[most,many,breakable]{tcolorbox}

\makeatletter


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                              %
%                                Basic Settings                                %
%                                                                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifx\nauthor\undefined
  \def\nauthor{Hashem A. Damrah}
\else
\fi

\ifx\class\undefined
  \def\class{report}
\else
\fi

\newcommand{\globalcolor}[1]{%
  \color{#1}\global\let\default@color\current@color
}

\definecolor{linecolor1}{HTML}{3DC6F3}
\definecolor{linecolor2}{HTML}{F034A3}
\definecolor{linecolor3}{HTML}{F57215}
\definecolor{linecolor4}{HTML}{733786}
\definecolor{linecolor5}{HTML}{80CF5C}
\definecolor{linecolor6}{HTML}{FFD700}
\definecolor{correct}{HTML}{00FF00}
\definecolor{incorrect}{HTML}{FF0000}
\definecolor{tbl}{HTML}{F035A3}
\definecolor{main}{HTML}{F035A3}
\definecolor{solution}{HTML}{00AEEF}
\definecolor{qedexample}{HTML}{76B4CF}
\definecolor{subsubsection}{HTML}{B00D15}
\definecolor{example}{HTML}{00A6E4}
\definecolor{examplebg}{HTML}{F2FBF8}
\definecolor{pagtwo}{HTML}{3E4547}
\definecolor{red1}{HTML}{ffccd5}
\definecolor{red2}{HTML}{ffb3c1}
\definecolor{red3}{HTML}{ff8fa3}
\definecolor{red4}{HTML}{ff758f}
\definecolor{red5}{HTML}{ff4d6d}
\definecolor{red6}{HTML}{c9184a}
\definecolor{red7}{HTML}{a4133c}
\definecolor{red8}{HTML}{800f2f}
\definecolor{red9}{HTML}{590d22}
\definecolor{red10}{HTML}{c9181e}
\definecolor{red11}{HTML}{c91876}
\definecolor{red12}{HTML}{e5235a}
\definecolor{cbada55}{RGB}{186,218,85}
\definecolor{c2c2c2c}{RGB}{44,44,44}
\definecolor{cc9184a}{RGB}{201,24,74}
\definecolor{c8d354e}{RGB}{141,53,78}
\definecolor{cff4d6d}{RGB}{255,77,109}
\definecolor{cff758f}{RGB}{255,117,143}

\colorlet{definition}{main}
\colorlet{theorem}{main}
\colorlet{corollary}{main}
\colorlet{lemma}{main}
\colorlet{proof}{main}
\colorlet{remark}{main}
\colorlet{qedproof}{proof}
\colorlet{question}{example}
\colorlet{questionfg}{examplebg}

% Disable indent
\setlength{\parindent}{0pt}

% Geometry
\geometry{
  top=1in,
  bottom=1in,
  right=1in,
  left=1in,
}

% Tables
\newcolumntype{C}{>{\Centering\arraybackslash}X}
\setlength{\tabcolsep}{5pt}
\renewcommand\arraystretch{1.5}
\renewcommand\thetable{\Roman{table}}
\captionsetup[figure]{font=small}
\captionsetup{justification=centering}
\setlength\cellspacetoplimit{6pt}
\setlength\cellspacebottomlimit{6pt}

% Symbols
\allowdisplaybreaks
\let\svlim\lim\def\lim{\svlim\limits}
\let\svsum\sum\def\sum{\svsum\limits}

% Lists
\setlist[itemize,1]{label=--}
\setlist[itemize,2]{label=\textbullet}
\setlist[enumerate,1]{label=\protect\circled{\arabic*}}

% SI Unitx
\sisetup{
  locale = US,
  per-mode = symbol,
  propagate-math-font = true,
  reset-math-version = false,
  exponent-mode = engineering,
  round-mode = figures,
  round-precision = 3,
  drop-zero-decimal,
}

\DeclareSIUnit{\millimeter}{mm}
\DeclareSIUnit{\centimeter}{cm}
\DeclareSIUnit{\decimeter}{dm}
\DeclareSIUnit{\inch}{in}
\DeclareSIUnit{\foot}{ft}
\DeclareSIUnit{\yard}{yd}
\DeclareSIUnit{\meter}{m}
\DeclareSIUnit{\kilometer}{km}
\DeclareSIUnit{\mile}{mi}
\DeclareSIUnit{\astronomicalunit}{au}
\DeclareSIUnit{\lightyear}{ly}
\DeclareSIUnit{\fahrenheit}{F}
\DeclareSIUnit{\celsius}{C}
\DeclareSIUnit{\millisecond}{ms}
\DeclareSIUnit{\second}{sec}
\DeclareSIUnit{\minute}{min}
\DeclareSIUnit{\hour}{hr}
\DeclareSIUnit{\day}{d}
\DeclareSIUnit{\week}{wk}
\DeclareSIUnit{\month}{mos}
\DeclareSIUnit{\year}{yr}
\DeclareSIUnit{\milligram}{mg}
\DeclareSIUnit{\gram}{g}
\DeclareSIUnit{\ounce}{oz}
\DeclareSIUnit{\pound}{lb}
\DeclareSIUnit{\kilogram}{kg}
\DeclareSIUnit{\ton}{t}
\DeclareSIUnit{\gallon}{gal}
\DeclareSIUnit{\liter}{L}
\DeclareSIUnit{\milliliter}{mL}

% Center Title Page
\renewcommand\maketitlehooka{\null\mbox{}\vfill}
\renewcommand\maketitlehookd{\vfill\null}

% Footnote Line
\renewcommand\footnoterule{\hrule\vspace{0.1cm}}

% Modify Links Color
\hypersetup{
  colorlinks,
  linkcolor=main!90,
  citecolor=linecolor1,
  urlcolor=linecolor1,
}

%%%%%%%%%%
%  TikZ  %
%%%%%%%%%%

\usetikzlibrary{
  shadings,
  intersections,
  angles,
  quotes,
  calc,
  positioning,
  3d,
  perspective,
  arrows,
  arrows.meta,
  patterns,
  decorations.markings,
  bending,
  decorations.pathreplacing,
  calligraphy,
  backgrounds,
}
% \tikzexternalize

\tikzoption{canvas is xy plane at z}[]{%
	\def\tikz@plane@origin{\pgfpointxyz{0}{0}{#1}}%
	\def\tikz@plane@x{\pgfpointxyz{1}{0}{#1}}%
	\def\tikz@plane@y{\pgfpointxyz{0}{1}{#1}}%
	\tikz@canvas@is@plane}

\usetikzlibrary{shapes.arrows}
\tikzset{every pin/.style={pin edge={<-}}}
\tikzset{flow/.style={
    decoration={
      markings,mark=at position #1 with {\arrow{>}}
    },postaction={decorate}
  },
  flow/.default=0.5
}

\tikzset{balls/.pic={
  \fill[red5!10] (-.06cm,0) circle (2pt);
  \fill[red5!20] (-.045cm,0) circle (2pt);
  \fill[red5!30] (-.03cm,0) circle (2pt);
  \fill[red5!40] (-0.015cm,0) circle (2pt);
  \fill[red5!50] (0,0) circle (2pt);
  \fill[red5!60] (0.015cm,0) circle (2pt);
  \fill[red5!70] (.03cm,0) circle (2pt);
  \fill[red5!80] (.045cm,0) circle (2pt);
  \fill[red5!90] (.06cm,0) circle (2pt);}
}

\tikzset{threedballs/.pic={
    \pgfmathsetmacro{\randomIntensity}{random(3,5)} % Generates a random number between 3 and 6
    \fill [color= red\randomIntensity!20!pagtwo]  (0.002cm,0.002cm,0) circle (0.02cm);
    \fill [color= red\randomIntensity!35!pagtwo]  (0.001cm,0.001cm,0) circle (0.0225cm);
    \fill [color= red\randomIntensity!50!pagtwo]   (0,0,0) circle (0.025cm);
    \fill [color= red\randomIntensity!70!pagtwo] (-0.001cm,-0.001cm,0) circle (0.0275cm);
    \fill [color= red\randomIntensity] (-0.002cm,-0.002cm,0) circle (0.03cm);
  }
}

\def\kB{1.38e-23} % Boltzmann constant
\def\mu{1.66e-27} % unified atomic mass unit/Dalton (symbols: m_u or Da)
\def\maxwellboltzmann#1{4 * pi * (\mu / (2 * pi * \kB * #1))^(3/2) * x^2 * exp(-\mu * x^2 / (2 * \kB * #1))}

\tikzset{threedballstwo/.pic={
		\pgfmathsetmacro{\randomIntensity}{random(3,5)} % Generates a random number between 3 and 6
		\fill [color= red\randomIntensity, opacity=0.2]  (0.004cm,0.004cm,0) circle (0.02cm);
		\fill [color= red\randomIntensity, opacity=0.4]  (0.002cm,0.002cm,0) circle (0.0225cm);
		\fill [color= red\randomIntensity, opacity=0.6]   (0,0,0) circle (0.025cm);
		\fill [color= red\randomIntensity, opacity=0.8] (-0.002cm,-0.002cm,0) circle (0.0275cm);
		\fill [color= red\randomIntensity] (-0.004cm,-0.004cm,0) circle (0.03cm);
  }
}

\tikzset{threedballsthree/.pic={
		\pgfmathsetmacro{\randomIntensity}{random(3,5)} % Generates a random number between 3 and 6
		\fill [color= red\randomIntensity] (-0.00cm,-0.00cm,0) circle (0.07cm);
  }
}

\newcommand\graphslopefield{
  \pgfmathsetmacro{\hx}{(\xmax-\xmin)/\nx}
  \pgfmathsetmacro{\hy}{(\ymax-\ymin)/\ny}
  \foreach \i in {0,...,\nx}
  \foreach \j in {0,...,\ny}{
    \pgfmathsetmacro{\yprime}{f({\xmin+\i*\hx},{\ymin+\j*\hy})}
    \draw[black,shift={({\xmin+\i*\hx},{\ymin+\j*\hy})}] 
    (0,0)--($(0,0)!2mm!(.1,.1*\yprime)$);
  }

  \draw[->] (\xmin-.5,0)--(\xmax+.5,0) node[below right] {$x$};
  \draw[->] (0,\ymin-.5)--(0,\ymax+.5) node[above left] {$y$};
}

\tikzset{background rectangle/.style={draw=main, line width=0.5pt, inner xsep=0.5cm, inner ysep=0.5cm}}

\tikzset{style1/.style={color=linecolor1,mark=none,line width=1pt,solid}}
\tikzset{style2/.style={color=linecolor2,mark=none,line width=1pt,solid}}
\tikzset{style3/.style={color=linecolor3,mark=none,line width=1pt,solid}}
\tikzset{style4/.style={color=linecolor4,mark=none,line width=1pt,solid}}
\tikzset{style5/.style={color=linecolor5,mark=none,line width=1pt,solid}}

\tikzset{integration1/.style={color=linecolor1,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}
\tikzset{integration2/.style={color=linecolor2,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}
\tikzset{integration3/.style={color=linecolor3,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}
\tikzset{integration4/.style={color=linecolor4,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}
\tikzset{integration5/.style={color=linecolor5,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}

\tikzset{derivative/.style={color=gray,mark=none,line width=0.5pt,solid}}
\tikzset{asymptote/.style={color=gray,mark=none,line width=1pt,<->,dashed}}
\tikzset{soldot/.style={color=linecolor2,fill=linecolor2,only marks,mark=*}}
\tikzset{holdot/.style={color=linecolor2,fill=white,only marks,mark=*}}

\tikzset{>=stealth}
\tikzset{->-/.style={decoration={markings,mark=at position .5 with {\arrow{>}}},postaction={decorate}}}

%%%%%%%%%%%%%%
%  PgfPlots  %
%%%%%%%%%%%%%%

\pgfplotsset{compat=1.18}

\usepgfplotslibrary{colormaps,patchplots}
\usepgfplotslibrary{groupplots}
\usepgfplotslibrary{fillbetween}
\usepgfplotslibrary{external}
\usepgfplotslibrary{colorbrewer}

\pgfplotsset{%
  colormap={integration}{
    color=(linecolor1)
    color=(linecolor2)
  },
}

\def\axisdefaultwidth{175pt}
\def\axisdefaultheight{\axisdefaultwidth}
\pgfplotsset{
  every axis/.append style={
    axis x line=middle, x axis line style={name path=xaxis},
    axis y line=middle, y axis line style={name path=yaxis},
    ticks=none,
    axis line style={->},
    xlabel={$x$},
    ylabel={$y$},
    samples=1000,
    cycle list name=stylelist
  },
}

\pgfplotsset{style1/.style={color=linecolor1,mark=none,line width=1pt,solid}}
\pgfplotsset{style2/.style={color=linecolor2,mark=none,line width=1pt,solid}}
\pgfplotsset{style3/.style={color=linecolor3,mark=none,line width=1pt,solid}}
\pgfplotsset{style4/.style={color=linecolor4,mark=none,line width=1pt,solid}}
\pgfplotsset{style5/.style={color=linecolor5,mark=none,line width=1pt,solid}}

\pgfplotsset{integration1/.style={color=linecolor1,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}
\pgfplotsset{integration2/.style={color=linecolor2,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}
\pgfplotsset{integration3/.style={color=linecolor3,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}
\pgfplotsset{integration4/.style={color=linecolor4,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}
\pgfplotsset{integration5/.style={color=linecolor5,fill=linecolor1!20,fill opacity=0.5,mark=none,line width=1pt,solid}}

\pgfplotsset{asymptote/.style={color=gray,mark=none,line width=1pt,<->,dashed}}
\pgfplotsset{soldot/.style={color=linecolor2,only marks,mark=*}}
\pgfplotsset{holdot/.style={color=linecolor2,fill=white,only marks,mark=*}}

\pgfplotscreateplotcyclelist{stylelist}{
  style1,
  style2,
  style3,
  style4,
  style5,
}

% Edit Section/Subsection/Subsubsection
\titleformat*{\section}{\sffamily\scshape\fontsize{14}{16}\bfseries}
\titleformat*{\subsection}{\color{subsubsection}\scshape\sffamily\fontsize{13}{15}\bfseries}
\def\@seccntformat#1{\llap{\csname the#1\endcsname\quad}}
\renewcommand\thesection{\arabic{section}}

\renewcommand\theequation{\arabic{equation}}
\renewcommand\tagform@[1]{%
  {\color{main}\boxed{\textbf{#1}}}
}
\def\@eqnnum{{\normalfont \normalcolor \theequation}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                              %
%                           School Specific Commands                           %
%                                                                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%
%  Helpful Commands  %
%%%%%%%%%%%%%%%%%%%%%%

\newcommand\resetcounters{
  \setcounter{section}{0}
  \setcounter{subsection}{0}
  \setcounter{subsubsection}{0}
  \setcounter{paragraph}{0}
  \setcounter{subparagraph}{0}
}

\newcommand*\cleartoleftpage{%
  \clearpage
  \thispagestyle{empty}
  \ifodd\value{page}\else\hbox{}\newpage\fi
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Lecture/Chapter Command  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\notenum{}
\newcommand\includenote[1]{
  \ifnum #1<10
    \def\notenum{0#1}
  \else
    \def\notenum{#1}
  \fi

  \setcounter{chapter}{#1}
  \resetcounters
  \IfFileExists{\noteloc-\notenum.tex}{\input{\noteloc-\notenum.tex}}{}
}

\newcommand\includenotes[2]{
  \foreach \n in {#1,...,#2}{
    \includenote{\n}
  }
}

\newcommand\localtoc{
  \startcontents
  \printcontents{}{1}{\noindent{\color{main}\rule{\textwidth}{0.4pt}\par}\vspace*{-0.3cm}\subsection*{{\color{main}Lecture Note Overview}}}
  \noindent{{\color{main}\rule{\textwidth}{0.4pt}\par}}
}

\newcommand\removetocentry[1]{%
  \addtocontents{toc}{\protect\setcounter{tocdepth}{-1}}
  #1
  \addtocontents{toc}{\protect\setcounter{tocdepth}{\arabic{tocdepth}}}
}

\newcounter{nte}[chapter]
\def\@note{}
\NewDocumentCommand\nte{O{} O{} m m}{%
  \cleartoleftpage
  \setcounter{nte}{\arabic{chapter}}
  \resetcounters
  \ifthenelse{\isempty{#3}}{%
    \def\@note{\lecorchap~\arabic{chapter}}
  }{%
    \def\@note{\lecorchap~\arabic{chapter}: #4}
  }%
  \phantomsection\addcontentsline{toc}{chapter}{\protect\numberline{\thechapter}#4}
  {\fontsize{10}{12}\selectfont\sffamily\ifstrequal{#1}{}{}{\noindent#1}\ifstrequal{#3}{}{}{\hfill#3}}
  \vspace*{0.03cm}
  \hrule
  \vspace*{0.3cm}
  \noindent{\bfseries\sffamily\fontsize{20}{30}\selectfont\@note}

  \ifstrequal{#2}{false}{\vspace{0.25cm}}{\localtoc}
  \setcounter{section}{0}
}

% Intro
\newcommand\createintro{
  \maketitle

  \pagenumbering{roman}
  \begin{center}
    \textbf{{\LARGE Introduction}}
  \end{center}

  \begingroup
  \IfFileExists{./intro.tex}{
    \setlength{\parindent}{1cm}
    \input{intro.tex}
  }{}
  \endgroup

  \pagestyle{fancy}
  \renewcommand\headrulewidth{0pt}

  \fancyhead{}
  \fancyfoot[C]{%
    \textit{For more notes like this, visit \href{\linktootherpages}{\shortlinkname}}.%
  }%

  \begin{tcolorbox}[
      enhanced,
      colback=white,
      center upper,
      size=fbox,
      drop shadow southwest,
      sharp corners,
    ]
    \term: \academicyear, \\
    Last Update: \today, \\
    \faculty, \location.
  \end{tcolorbox}

  \newpage
  \tableofcontents

  \pagenumbering{arabic}
  \setcounter{page}{1}

  \renewcommand\headrulewidth{0.4pt}
  \fancyhead[R]{\@note}
  \fancyhead[L]{\nauthor}
  \fancyfoot[C]{\thepage}
}

%%%%%%%%%%%%%%%%%%%%%
%  Random Commands  %
%%%%%%%%%%%%%%%%%%%%%

% Import Figures
\newcommand\incimg[2][1]{%
  \includegraphics[width=#1\columnwidth]{\figloc-\notenum/#2}%
}

\newcommand\incfig[2][1]{
  \def\svgwidth{#1\columnwidth}
  \import{\figloc-\notenum}{#2.pdf_tex}
}

% Circle
\newcommand*\circled[1]{
  \tikz[baseline=(char.base)] {
    \node[shape=circle,draw,inner sep=1pt] (char) {#1};
  }
}
\newcommand\coloredcircle[1]{\tikz[baseline=(char.base)] {
    \node[shape=circle,draw,inner sep=1pt,color=#1,fill=#1!50] (char) {\phantom{$1$}};
  }
}

% Correct
\newcommand\correct[1]{\textcolor{correct}{#1}}
\newcommand\incorrect[1]{{\color{incorrect}#1}}
\newcommand\inctocor[2]{\incorrect{#1} \ensuremath{\to} \correct{#2}}

% hfill during math mode
\newcommand{\pushright}[1]{\ifmeasuring@#1\else\omit\hfill$\displaystyle#1$\fi\ignorespaces}

% Bracket
\renewcommand\bra[1]{\left\langle#1\right|}
\renewcommand\ket[1]{\left|#1\right\rangle}
\renewcommand\braket[2]{\left\langle#1\middle|#2\right\rangle}
\renewcommand\ang[1]{\left\langle#1\right\rangle}

% Important
\newcommand\imp[1]{{\color{main}#1}}

% For diagonal strikeout in red
\newcommand\rcancel[1]{\renewcommand\CancelColor{\color{red}}\cancel{#1}}

% For differentials
\newcommand\dd[1]{\textrm{d}#1}
\newcommand\dA{\textrm{d}A}
\newcommand\dm{\textrm{d}m}
\newcommand\dt{\textrm{d}t}
\newcommand\dT{\textrm{d}T}
\newcommand\du{\textrm{d}u}
\newcommand\dv{\textrm{d}v}
\newcommand\dx{\textrm{d}x}
\newcommand\dy{\textrm{d}y}
\newcommand\dz{\textrm{d}z}

% Helpful text in math
\newcommand\echelon{\underrightarrow{\textrm{ echelon form }}}
\newcommand\rref{\underrightarrow{\textrm{ rref }}}
\newcommand\pick[1]{\xrightarrow[#1]{\textrm{ pick }}}
\newcommand\generalsol{\xrightarrow[\textrm{solution}]{\textrm{ general }}}
\newcommand\ngeneralsol{\parbox{4em}{general \\ solution}\textrm{:}}
\renewcommand\and{\text{and}}
\newcommand\aand{\quad\text{and}\quad}
\newcommand\adj{\text{adj}}
\newcommand\qtq[1]{\quad\textrm{#1}\quad}
\newcommand\oor{\quad\text{or}\quad}
\newcommand\Col{\textrm{Col}}
\newcommand\Nul{\textrm{Null}}
\newcommand\Tr{\textrm{Tr}}
\newcommand\Row{\textrm{Row}}
\newcommand\ran{\textrm{rank}}
\newcommand\dist{\text{dist}}
\newcommand\sz{\stackrel{\textrm{set}}{=}}
\newcommand\ce{\overset{\checkmark}{=}}
\newcommand\proj{\text{proj}}
\newcommand\comp{\text{comp}}
\newcommand\st{\text{such that}}
\newcommand\geogebra{\textsf{GeoGebra}}
\newcommand\Sspan{\text{Span}}
\renewcommand\Re{\text{Re}}
\renewcommand\Im{\text{Im}}

% Used to switch tag position
\newcommand\leqnomode{\tagsleft@true}
\newcommand\reqnomode{\tagsleft@false}

% Laplace
\newcommand\laplace[1]{\mathscr{L}\left\{#1\right\}}
\newcommand\ilaplace[1]{\mathscr{L}^{-1}\left\{#1\right\}}

% Vectors
\renewcommand\a{\mathbf{a}}
\renewcommand\b{\mathbf{b}}
\renewcommand\c{\mathbf{c}}
\renewcommand\d{\mathbf{d}}
\newcommand\e{\mathbf{e}}
\newcommand\f{\mathbf{f}}
\newcommand\g{\mathbf{g}}
\newcommand\n{\mathbf{n}}
\newcommand\p{\mathbf{p}}

\newcommand\RR{\mathbf{R}}
\newcommand\FF{\mathbf{F}}

\renewcommand\r{\mathbf{r}}
\newcommand\rr{\mathbf{r}^{\prime}}
\newcommand\rrr{\mathbf{r}^{\prime\prime}}

\newcommand\Ta{\mathbf{T}}
\newcommand\Taa{\mathbf{T}^{}}

\renewcommand\u{\mathbf{u}}
\newcommand\uu{\mathbf{u}^{\prime}}
\newcommand\uuu{\mathbf{u}^{\prime\prime}}

\renewcommand\v{\mathbf{v}}
\newcommand\vv{\mathbf{v}^{\prime}}
\newcommand\vvv{\mathbf{v}^{\prime\prime}}

\newcommand\w{\mathbf{w}}
\newcommand\x{\mathbf{x}}
\newcommand\y{\mathbf{y}}
\newcommand\z{\mathbf{z}}

\newcommand\zero{\mathbf{0}}

% Hat vectors
\newcommand\ah{\hat{\mathbf{a}}}
\newcommand\bh{\hat{\mathbf{b}}}
\newcommand\ch{\hat{\mathbf{c}}}
\renewcommand\dh{\hat{\mathbf{d}}}
\newcommand\eh{\hat{\mathbf{e}}}
\newcommand\ph{\hat{\mathbf{p}}}
\newcommand\uh{\hat{\mathbf{u}}}
\newcommand\vh{\hat{\mathbf{v}}}
\newcommand\wh{\hat{\mathbf{w}}}
\newcommand\xh{\hat{\mathbf{x}}}
\newcommand\yh{\hat{\mathbf{y}}}
\newcommand\zh{\hat{\mathbf{z}}}

% Unit vectors
\newcommand\ui{\mathbf{i}}
\newcommand\uj{\mathbf{j}}
\newcommand\uk{\mathbf{k}}

% Subspaces
\newcommand\B{\mathcal{B}}
\newcommand\CC{\mathbb{C}}
\newcommand\C{\mathcal{C}}
\newcommand\D{\mathcal{D}}
\newcommand\E{\mathcal{E}}
\newcommand\F{\mathcal{F}}
\newcommand\N{\mathbb{N}}
\newcommand\Q{\mathbb{Q}}
\newcommand\R{\mathbb{R}}
\newcommand\U{\mathcal{U}}
\newcommand\W{\mathbf{w}}
\newcommand\X{\mathcal{X}}
\newcommand\Y{\mathcal{Y}}
\newcommand\Z{\mathbb{Z}}

% Create command to box equations
\newcommand*\colorboxed{}
\def\colorboxed#1#{%
  \colorboxedAux{#1}%
}
\newcommand*\colorboxedAux[3]{%
  \begingroup
    \colorlet{cb@saved}{.}%
    \color#1{#2}%
    \boxed{%
      \color{cb@saved}%
      #3%
    }%
  \endgroup
}
\newcommand\empheq[1]{%
  \colorboxed{main}{%
    \begin{aligned}[b]
      #1
    \end{aligned}%
  }%
}

% L'Hopital's Rule
\newcommand\lop{\stackrel{\textrm{H}}{=}}

% Check mark
\def\checkmark{\tikz\fill[scale=0.4](0,.35) -- (.25,0) -- (1,.7) -- (.25,.15) -- cycle;} 

% Vinculum
\newcommand\vinculum[1]{\frac{\hspace{#1cm}}{}}

% Phase Lines (vertical/horizontal)
\newcommand*\TickSize{2pt}%
\newcommand*\AxisMin{0}%
\newcommand*\AxisMax{0}%
\newcommand*\PhaseLine[4][]{%
  \gdef\AxisMin{0}%
  \gdef\AxisMax{0}%
  \edef\MyList{#2}%
  \foreach \X in \MyList {
    \draw (-\TickSize,\X) -- (\TickSize,\X) node [right] {$\X$};
    \ifnum\AxisMin>\X
      \xdef\AxisMin{\X}%
    \fi
    \ifnum\AxisMax<\X
      \xdef\AxisMax{\X}%
    \fi
  }

  \edef\MyList{#3}%
  \foreach \X in \MyList {% Up arrows
    \draw [->] (0,\X-0.1) -- (0,\X);
    \ifnum\AxisMin>\X
      \xdef\AxisMin{\X}%
    \fi
    \ifnum\AxisMax<\X
      \xdef\AxisMax{\X}%
    \fi
  }

  \edef\MyList{#4}%
  \foreach \X in \MyList {% Down arrows
    \draw [->] (0,\X+0.1) -- (0,\X);
    \ifnum\AxisMin>\X
      \xdef\AxisMin{\X}%
    \fi
    \ifnum\AxisMax<\X
      \xdef\AxisMax{\X}%
    \fi
  }

  \draw  (0,\AxisMin-1) -- (0,\AxisMax+1) node [above] {#1};
}%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                              %
%                                 Environments                                 %
%                                                                              %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\mdfsetup{skipabove=1em,skipbelow=0em}
\tcbuselibrary{theorems,skins,hooks}

\newcommand\qedexample{{\color{qedexample}\rule{4mm}{1.5mm}}}
\newcommand\qedproof{{\color{qedproof}\rule{4mm}{1.5mm}}}

\xpatchcmd{\endmdframed}
  {\aftergroup\endmdf@trivlist\color@endgroup}
  {\endmdf@trivlist\color@endgroup\@doendpe}
  {}{}

\declaretheoremstyle[
  headfont=\sffamily\bfseries\color{definition},
  headformat=\fbox{\arabic{definition}}~\NAME\NOTE,
  bodyfont=\normalfont,
  headpunct=,
  mdframed={linecolor=definition, linewidth=0.5pt},
]{thmdefinitionbox}

\declaretheoremstyle[
  headfont=\sffamily\bfseries\color{theorem},
  headformat=\fbox{\arabic{theorem}}~\NAME\NOTE,
  bodyfont=\normalfont,
  headpunct=,
  mdframed={linecolor=theorem, linewidth=0.5pt},
]{thmtheorembox}

\declaretheoremstyle[
  headfont=\sffamily\bfseries\color{corollary},
  headformat=\fbox{\arabic{corollary}}~\NAME\NOTE,
  bodyfont=\normalfont,
  headpunct=,
  mdframed={linecolor=corollary, linewidth=0.5pt},
]{thmcorollarybox}

\declaretheoremstyle[
  headfont=\sffamily\bfseries\color{lemma},
  headformat=\fbox{\arabic{lemma}}~\NAME\NOTE,
  bodyfont=\normalfont,
  headpunct=,
  mdframed={linecolor=lemma, linewidth=0.5pt},
]{thmlemmabox}

\declaretheoremstyle[
  headfont=\sffamily\bfseries\color{example},
  headformat=\NAME\NOTE,
  bodyfont=\normalfont,
  headpunct=,
  qed=\qedexample,
  mdframed={leftline=false, rightline=false, topline=false, bottomline=false},
]{thmexamplebox}

\declaretheoremstyle[
  headfont=\sffamily\bfseries\color{question}QUESTION \arabic{question},
  headformat=\textbf{\NOTE},
  notefont=\bfseries,
  bodyfont=\normalfont,
  notefont={\color{black}\bfseries},
  notebraces={()},
  headpunct=,
  mdframed={leftline=false, rightline=false, topline=false, bottomline=false},
]{thmquestionbox}

\declaretheoremstyle[
  headfont=\sffamily\bfseries\color{remark},
  bodyfont=\itshape,
  notebraces={~ },
  notefont=\bfseries,
  headpunct=,
  mdframed={
    linecolor=remark, linewidth=0.5pt,
    rightline=false, topline=false, bottomline=false,
  },
]{thmremarkbox}

\declaretheoremstyle[
  headfont=\sffamily\color{proof},
  headformat=\NAME,
  headindent=0mm,
  bodyfont=\normalfont,
  notefont=\bfseries,
  headpunct=,
  qed=\qedproof,
  mdframed={
    linewidth=0.5pt, linecolor=proof,
    rightline=false, topline=false, bottomline=false,
  },
]{thmreplacementproofbox}

\declaretheoremstyle[
  headfont=\sffamily,
  headindent=24pt,
  bodyfont=\itshape,
  notefont=\bfseries,
  notebraces={~ },
  headpunct=:,
  mdframed={
    leftline=false, rightline=false, topline=false, bottomline=false,
  },
]{thmmainplainbox}

\declaretheoremstyle[
  headfont=\sffamily\color{main},
  headformat=\parbox{\textwidth}{\centering\NAME~\NOTE},
  headindent=0mm,
  bodyfont=\normalfont,
  notefont=\bfseries,
  notebraces={~ },
  headpunct=,
  mdframed={
    linecolor=main, linewidth=0.5pt,
  },
]{thmpurpleframebox}

\newenvironment{envwithwhite}{\begingroup\color{white}}{\endgroup}

\declaretheorem[              style=thmdefinitionbox,       name=Definition]      {definition}
\declaretheorem[              style=thmtheorembox,          name=Theorem]         {theorem}
\declaretheorem[              style=thmcorollarybox,        name=Corollary]       {corollary}
\declaretheorem[              style=thmlemmabox,            name=Lemma]           {lemma}
\declaretheorem[              style=thmexamplebox,          name=Example]         {example}
\declaretheorem[              style=thmquestionbox,         name=]                {question}
\declaretheorem[              style=thmreplacementproofbox, name=PROOF]           {replacementproof}
\declaretheorem[numbered=no,  style=thmremarkbox,           name=Remark]          {remark}

\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Proposition]     {proposition}
\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Conjecture]      {conjecture}
\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Explanation]     {explanation}
\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Notation]        {notation}
\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Recall]          {recall}
\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Claim]           {claim}
\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Case]            {case}
\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Acknowledgment]  {acknowledgment}
\declaretheorem[numbered=no,          style=thmmainplainbox,        name=Conclusion]      {conclusion}

\newtheoremstyle{side}{}{}{\advance\leftskip3cm\relax}{}
{\bfseries}{}{0pt}{%
  \makebox[0pt][r]{%
    \smash{\parbox[t]{2.5cm}{\raggedright\thmname{#1}%
    \thmnumber{\space #2}\thmnote{\newline (#3)}}}%
\hspace{.5cm}}}

\theoremstyle{side}
\newtheorem*{note}{Note.}

\renewenvironment{proof}[1][\proofname]{\vspace{-10pt}\begin{replacementproof}}{\end{replacementproof}}

\newtcolorbox{solution}{
  tikznode boxed title,
  colback=white,
  enhanced,
  attach boxed title to top center={
    yshift=-3mm,
    yshifttext=-1mm,
  },
  boxed title style={
    size=small,
    colback=white,
    frame code={},
  },
  title={\sffamily\color{solution}SOLUTION~\arabic{question}},
  frame hidden,
  borderline north={0.5pt}{0pt}{question},
  borderline south={0.5pt}{0pt}{question},
  breakable,
  parskip=\baselineskip,
}

\newtcolorbox{solproof}{
  tikznode boxed title,
  colback=white,
  enhanced,
  attach boxed title to top center={
    yshift=-3mm,
    yshifttext=-1mm,
  },
  boxed title style={
    size=small,
    colback=white,
    frame code={},
  },
  title={\sffamily\color{solution}PROOF~\arabic{question}},
  frame hidden,
  borderline north={0.5pt}{0pt}{question},
  borderline south={0.5pt}{0pt}{question},
  breakable,
  parskip=\baselineskip,
}

\newcommand\prpl[1][]{%
  \begin{tcolorbox}[%
    title={\sffamily\color{main}#1},
    colback=white,
    enhanced,
    attach boxed title to top center={
      yshift=-3mm,
      yshifttext=-1mm,
    },
    boxed title style={
      size=small,
      colback=white,
      frame code={},
    },
    frame hidden,
    borderline east={0.5pt}{0pt}{main},
    borderline west={0.5pt}{0pt}{main},
    borderline north={0.5pt}{0pt}{main},
    borderline south={0.5pt}{0pt}{main},
    breakable,
    parskip=0pt,
  ]
}

\newenvironment{purpleframe}[1][]{%
  \prpl[#1]%
}{%
  \end{tcolorbox}%
}

%%%%%%%%%%%%%%%%%%
%  Cref Styling  %
%%%%%%%%%%%%%%%%%%

\crefname{definition}{definition}{definitions}
\Crefname{definition}{Definition}{Definitions}

\crefname{theorem}{theorem}{theorems}
\Crefname{theorem}{Theorem}{Theorems}

\crefname{example}{example}{examples}
\Crefname{example}{Example}{Examples}

\crefname{question}{question}{questions}
\Crefname{question}{Question}{Questions}

\crefname{solution}{solution}{solutions}
\Crefname{solution}{Solution}{Solutions}

\crefname{solproof}{proof}{proofs}
\Crefname{solproof}{Proof}{Proofs}

\crefname{remark}{remark}{remarks}
\Crefname{remark}{Remark}{Remarks}

\crefname{note}{note}{notes}
\Crefname{note}{Note}{Notes}

\crefname{problem}{problem}{problem}
\Crefname{problem}{Problem}{Problems}

\crefname{lemma}{lemma}{lemmas}
\Crefname{lemma}{Lemma}{Lemmas}

\crefname{corollary}{corollary}{corollaries}
\Crefname{corollary}{Corollary}{Corollaries}

\crefname{proposition}{proposition}{propositions}
\Crefname{proposition}{Proposition}{Propositions}

\crefname{conjecture}{conjecture}{conjectures}
\Crefname{conjecture}{Conjecture}{Conjectures}

\crefname{explanation}{explanation}{explanations}
\Crefname{explanation}{Explanation}{Explanations}

\crefname{notation}{notation}{notations}
\Crefname{notation}{Notation}{Notations}

\crefname{recall}{recall}{recalls}
\Crefname{recall}{Recall}{Recalls}

\crefname{claim}{claim}{claims}
\Crefname{claim}{Claim}{Claims}

\crefname{case}{case}{cases}
\Crefname{case}{Case}{Cases}

\crefname{acknowledgment}{acknowledgment}{acknowledgments}
\Crefname{acknowledgment}{Acknowledgment}{Acknowledgments}

\crefname{conclusion}{conclusion}{conclusions}
\Crefname{conclusion}{Conclusion}{Conclusions}

\crefname{proof}{proof}{proofs}
\Crefname{proof}{Proof}{Proofs}

\creflabelformat{equation}{#2\textup{#1}#3}
\creflabelformat{table}{#2\textup{#1}#3}
\creflabelformat{figure}{#2\textup{#1}#3}

\AtBeginDocument{%
  \newcommand*{\original@ref}{}%
  \let\original@ref\ref
  \renewcommand*{\ref}{\@ifstar\newrefstar\newref}
  \newcommand*{\newrefstar}[1]{%
    \textbf{\hyperref[{#1}]{\autoref*{#1} \nameref*{#1}}}
  }%
  \newcommand*{\newref}[1]{%
    \textbf{\nameref{#1} (\hyperref[{#1}]{\autoref{#1})}}
  }%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                     %
%                          Table of Contents                          %
%                                                                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{titletoc,titlesec}
\contentsmargin{0cm}
\titlecontents{chapter}[3.7pc]
{\addvspace{30pt}%
	\begin{tikzpicture}[remember picture, overlay]%
		\draw[fill=main!60,draw=main!60] (-7,-.1) rectangle (-0.7,.5);%
		\pgftext[left,x=-3.6cm,y=0.2cm]{\color{white}\Large\sc\bfseries \lecorchap\ \thecontentslabel};%
	\end{tikzpicture}\color{main!60}\large\sc\bfseries}%
{}
{}
{\;\titlerule\;\large\sc\bfseries Page \thecontentspage
	\begin{tikzpicture}[remember picture, overlay]
		\draw[fill=main!60,draw=main!60] (2pt,0) rectangle (4,0.1pt);
\end{tikzpicture}}%
\titlecontents{section}[3.7pc]
{\addvspace{2pt}}
{\contentslabel[\thecontentslabel]{2pc}}
{}
{\hfill\small \thecontentspage}
[]
\titlecontents{subsection}[3.7pc]
{\addvspace{-1pt}\small}
{\hspace*{2pc}\contentslabel[\thecontentslabel]{2pc}}
{}
{\hfill\small \thecontentspage}
[]

\renewcommand{\tableofcontents}{%
	\chapter*{%
		\vspace*{-20\p@}%
		\begin{tikzpicture}[remember picture, overlay]%
			\pgftext[right,x=15cm,y=0.2cm]{\color{main!60}\Huge\sc\bfseries \contentsname};%
			\draw[fill=main!60,draw=main!60] (13,-.75) rectangle (20,1);%
			\clip (13,-.75) rectangle (20,1);
			\pgftext[right,x=15cm,y=0.2cm]{\color{white}\Huge\sc\bfseries \contentsname};%
	\end{tikzpicture}}%
	\@starttoc{toc}}
\titleformat{\chapter}[display]
{\normalfont\Huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}

\makeatother
